#!/usr/bin/env bash

set -e

# source the .env file if it exists
[[ -f .env ]] && source .env

image="harmony/gdal"
tag=${1:-latest}

if [ -d "deps" ]; then
    rm -rf deps
fi
mkdir deps

if [ -d "$LOCAL_HSLP" ]; then
    HSLP_DIR=$(basename $LOCAL_HSLP)
    cp -R $LOCAL_HSLP deps/
fi

# If we're running Docker in Docker (DIND) then the docker daemon is on the host
if [ -n "$DIND" ]; then
  docker -H $DOCKER_DAEMON_ADDR build -t ${image}:${ag} .
else
  docker build --network host -t ${image}:${tag} .
fi
